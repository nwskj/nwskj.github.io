<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>docker 教程 | 半亩方塘</title><meta name="author" content="邢剑锋"><meta name="copyright" content="邢剑锋"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Docker、Docker-compose 入门教程1 Docker 简介 1.1 Docker 是什么？ docker 是一个开源的应用容器引擎。 1 Docker 简介 1.1 Docker 是什么？ docker 是一个开源的应用容器引擎。 1.2 容器是什么？ 容器是一种轻量级的虚拟化技术 ，它是一个由应用运行环境、容器基础镜像组成的集合。 以 Web 服务 Nginx 为例，如下图所示：">
<meta property="og:type" content="website">
<meta property="og:title" content="docker 教程">
<meta property="og:url" content="http://example.com/system/docker/index.html">
<meta property="og:site_name" content="半亩方塘">
<meta property="og:description" content="Docker、Docker-compose 入门教程1 Docker 简介 1.1 Docker 是什么？ docker 是一个开源的应用容器引擎。 1 Docker 简介 1.1 Docker 是什么？ docker 是一个开源的应用容器引擎。 1.2 容器是什么？ 容器是一种轻量级的虚拟化技术 ，它是一个由应用运行环境、容器基础镜像组成的集合。 以 Web 服务 Nginx 为例，如下图所示：">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://s1.ax1x.com/2023/04/14/ppzyLAs.png">
<meta property="article:published_time" content="2025-01-06T05:13:12.836Z">
<meta property="article:modified_time" content="2025-01-06T05:13:12.836Z">
<meta property="article:author" content="邢剑锋">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://s1.ax1x.com/2023/04/14/ppzyLAs.png"><link rel="shortcut icon" href="https://s1.ax1x.com/2023/04/14/ppzyLAs.png"><link rel="canonical" href="http://example.com/system/docker/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":200},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  }
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'docker 教程',
  isPost: false,
  isHome: false,
  isHighlightShrink: true,
  isToc: false,
  postUpdate: '2025-01-06 05:13:12'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="半亩方塘" type="application/atom+xml">
</head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://s1.ax1x.com/2023/04/14/ppzyLAs.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">84</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">41</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">5</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-book"></i><span> 人生计事</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="//"><i class="fa-fw fas fa-archive"></i><span> 人生计事</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-computer"></i><span> 继续教育</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/jy/gjkfdx/"><i class="fa-fw fas fa-computer"></i><span> 国家开放大学</span></a></li><li><a class="site-page child" href="/jy/ynkf/"><i class="fa-fw fas fa-computer"></i><span> 云南开放大学</span></a></li><li><a class="site-page child" href="/jy/lfjt/"><i class="fa-fw fas fa-computer"></i><span> 廊坊交通运输学校</span></a></li><li><a class="site-page child" href="/jy/zygbdsdx/"><i class="fa-fw fas fa-computer"></i><span> 中央广播电视大学</span></a></li><li><a class="site-page child" href="/jy/bm/"><i class="fa-fw fas fa-computer"></i><span> 报名材料</span></a></li><li><a class="site-page child" href="/jy/zyhz/"><i class="fa-fw fas fa-computer"></i><span> 专业汇总</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://bnjy.eu.org/"><i class="fa-fw fas fa-computer"></i><span> 继续教育</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-computer"></i><span> 系统软件</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/%E6%95%99%E7%A8%8B%E5%AD%A6%E4%B9%A0/"><i class="fa-fw fas fa-pen"></i><span> 教程学习</span></a></li><li><a class="site-page child" href="/categories/%E7%BB%8F%E5%85%B8%E5%A5%BD%E6%96%87/"><i class="fa-fw fas fa-pen"></i><span> 经典好文</span></a></li><li><a class="site-page child" href="/web/System/"><i class="fa-fw fas fa-computer"></i><span> 电脑系统</span></a></li><li><a class="site-page child" href="/web/rss/"><i class="fa-fw fas fa-computer"></i><span> 信息聚合</span></a></li><li><a class="site-page child" href="/dh/"><i class="fa-fw fas fa-computer"></i><span> 网址导航</span></a></li><li><a class="site-page child" href="/web/docker/"><i class="fa-fw fas fa-computer"></i><span> docker</span></a></li></ul></div><div class="menus_item"><a class="site-page" target="_blank" rel="noopener" href="https://cyjz.eu.org/"><i class="fa-fw fas fa-computer"></i><span> 旅游专线</span></a></div><div class="menus_item"><a class="site-page" href="/page/messageboard/"><i class="fa-fw fas fa-message"></i><span> 网站留言</span></a></div><div class="menus_item"><a class="site-page" href="/atom.xml"><i class="fa-fw fas fa-heart"></i><span> RSS+</span></a></div></div></div></div><div class="page" id="body-wrap"><header class="not-home-page" id="page-header" style="background-image: url('https://s1.ax1x.com/2023/04/13/ppjHQaT.jpg#')"><nav id="nav"><span id="blog-info"><a href="/" title="半亩方塘"><span class="site-name">半亩方塘</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-book"></i><span> 人生计事</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="//"><i class="fa-fw fas fa-archive"></i><span> 人生计事</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-computer"></i><span> 继续教育</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/jy/gjkfdx/"><i class="fa-fw fas fa-computer"></i><span> 国家开放大学</span></a></li><li><a class="site-page child" href="/jy/ynkf/"><i class="fa-fw fas fa-computer"></i><span> 云南开放大学</span></a></li><li><a class="site-page child" href="/jy/lfjt/"><i class="fa-fw fas fa-computer"></i><span> 廊坊交通运输学校</span></a></li><li><a class="site-page child" href="/jy/zygbdsdx/"><i class="fa-fw fas fa-computer"></i><span> 中央广播电视大学</span></a></li><li><a class="site-page child" href="/jy/bm/"><i class="fa-fw fas fa-computer"></i><span> 报名材料</span></a></li><li><a class="site-page child" href="/jy/zyhz/"><i class="fa-fw fas fa-computer"></i><span> 专业汇总</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://bnjy.eu.org/"><i class="fa-fw fas fa-computer"></i><span> 继续教育</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-computer"></i><span> 系统软件</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/%E6%95%99%E7%A8%8B%E5%AD%A6%E4%B9%A0/"><i class="fa-fw fas fa-pen"></i><span> 教程学习</span></a></li><li><a class="site-page child" href="/categories/%E7%BB%8F%E5%85%B8%E5%A5%BD%E6%96%87/"><i class="fa-fw fas fa-pen"></i><span> 经典好文</span></a></li><li><a class="site-page child" href="/web/System/"><i class="fa-fw fas fa-computer"></i><span> 电脑系统</span></a></li><li><a class="site-page child" href="/web/rss/"><i class="fa-fw fas fa-computer"></i><span> 信息聚合</span></a></li><li><a class="site-page child" href="/dh/"><i class="fa-fw fas fa-computer"></i><span> 网址导航</span></a></li><li><a class="site-page child" href="/web/docker/"><i class="fa-fw fas fa-computer"></i><span> docker</span></a></li></ul></div><div class="menus_item"><a class="site-page" target="_blank" rel="noopener" href="https://cyjz.eu.org/"><i class="fa-fw fas fa-computer"></i><span> 旅游专线</span></a></div><div class="menus_item"><a class="site-page" href="/page/messageboard/"><i class="fa-fw fas fa-message"></i><span> 网站留言</span></a></div><div class="menus_item"><a class="site-page" href="/atom.xml"><i class="fa-fw fas fa-heart"></i><span> RSS+</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="page-site-info"><h1 id="site-title">docker 教程</h1></div></header><main class="layout hide-aside" id="content-inner"><div id="page"><div id="article-container"><h1 id="Docker、Docker-compose-入门教程"><a href="#Docker、Docker-compose-入门教程" class="headerlink" title="Docker、Docker-compose 入门教程"></a>Docker、Docker-compose 入门教程</h1><p>1 Docker 简介 1.1 Docker 是什么？ docker 是一个开源的应用容器引擎。</p>
<p>1 Docker 简介 1.1 Docker 是什么？ docker 是一个开源的应用容器引擎。 1.2 容器是什么？ 容器是一种轻量级的虚拟化技术 ，它是一个由应用运行环境、容器基础镜像组成的集合。 以 Web 服务 Nginx 为例，如下图所示：Nginx 容器是由 Nginx 主程序、Ngin</p>
<h2 id="1-1-Docker-是什么？"><a href="#1-1-Docker-是什么？" class="headerlink" title="1.1 Docker 是什么？"></a>1.1 Docker 是什么？</h2><p>docker 是一个开源的应用容器引擎。</p>
<h2 id="1-2-容器是什么？"><a href="#1-2-容器是什么？" class="headerlink" title="1.2 容器是什么？"></a>1.2 容器是什么？</h2><p>容器是一种轻量级的虚拟化技术 ，它是一个由应用运行环境、容器基础镜像组成的集合。</p>
<p>以 Web 服务 Nginx 为例，如下图所示：Nginx 容器是由 Nginx 主程序、Nginx 运行依赖组件（gcc、pcre、openssl）、CentOS 7 基础镜像组成。（注：CentOS 7 基础镜像并非完整的操作系统镜像，只是操作系统的基础文件和库文件）</p>
<p><img src="https://kb.fit2cloud.com/upload/metersphere/图片-kfsh.png" alt="img"></p>
<h2 id="1-3-容器与虚拟机的区别"><a href="#1-3-容器与虚拟机的区别" class="headerlink" title="1.3 容器与虚拟机的区别"></a>1.3 容器与虚拟机的区别</h2><p><img src="https://kb.fit2cloud.com/upload/metersphere/%E5%9B%BE%E7%89%87-dxdj.png" alt="img"></p>
<ul>
<li><strong>启动速度：</strong>每个虚拟都机是一个完整的操作系统包括操作系统和内核，所以它是一个重量级的系统；而容器是轻量级的，因为容器只打包了操作系统的基础文件和库文件、还有应用程序及所有的依赖，他的运行速度就如同在系统中创建一个进程一样快，所以启动速度较快。</li>
<li><strong>运行性能：</strong>由于虚拟机增加了虚拟化层用于虚拟化硬件，势必会增加一定的开销，所以运行性能有所损失；而容器是直接运行在物理操作系统上的，他本身与系统上其他进程并没有太大区别，所以运行性能是接近原生的。</li>
<li><strong>磁盘占用：</strong>虚拟机是一个完整的操作系统，是 GB 级别的，而容器只包含了一些系统启动的必要组件和程序依赖，是 MB 级别的。</li>
<li><strong>数量：</strong>运行一个操作系统的开销较大，运行一个进程的开销较小，同样的服务器资源可以运行更多的容器。</li>
<li><strong>隔离性：</strong>虚拟机是一个完整的操作系统级别的隔离，要比容器好很多；容器是进程级别的隔离，隔离的不彻底，因为多个容器之间使用的是同一个宿主机的操作系统内核。</li>
<li><strong>封装速度：</strong>虚拟机封装会包含操作系统，封装速度比较慢，容器只封装操作系统的基础文件和库文件、应用程序、依赖，封装速度较快。</li>
</ul>
<h2 id="1-4-Docker-和容器的关系"><a href="#1-4-Docker-和容器的关系" class="headerlink" title="1.4 Docker 和容器的关系"></a>1.4 Docker 和容器的关系</h2><p>容器是一种虚拟化技术，docker 是实现容器的一种工具，我们称它为容器引擎；</p>
<p>可以驱动容器的引擎还有 podman、containerd 等，docker 是目前市面上应用范围最广的一种容器引擎。</p>
<p>在 CentOS 7 系统上安装 docker</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">yum install -y yum-utils device-mapper-persistent-data lvm2 &amp;&amp; \</span><br><span class="line">yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo &amp;&amp; yum makecache fast &amp;&amp; \ </span><br><span class="line">yum -y install docker-ce &amp;&amp; \</span><br><span class="line">mkdir -p /etc/docker</span><br><span class="line">tee /etc/docker/daemon.json &lt;&lt;-&#x27;EOF&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  &quot;registry-mirrors&quot;: [&quot;https://j6o4qczl.mirror.aliyuncs.com&quot;]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl enable docker</span><br><span class="line">systemctl restart docker</span><br></pre></td></tr></table></figure>
<p>执行以下命令，启动一个 Nginx 容器</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name nginx_test  nginx</span><br><span class="line"></span><br><span class="line">注释：</span><br><span class="line">-d					</span><br><span class="line">--name			</span><br><span class="line">nginx				</span><br></pre></td></tr></table></figure>
<p>使用 docker ps 可以看到有一个名为 nginx_test 的容器在运行；</p>
<p><img src="https://kb.fit2cloud.com/upload/metersphere/%E5%9B%BE%E7%89%87-rtgw.png" alt="img"></p>
<p>进入容器查看服务</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">docker exec -it nginx_test bash</span><br><span class="line"></span><br><span class="line">注释：</span><br><span class="line">-it		</span><br><span class="line">nginx_test	</span><br><span class="line">bash	</span><br></pre></td></tr></table></figure>
<p>执行命令后，shell 端的主机名变成了随机字段串，说明进入到了容器内部；</p>
<p><img src="https://kb.fit2cloud.com/upload/metersphere/%E5%9B%BE%E7%89%87-nufu.png" alt="img"></p>
<p>在 Nginx 容器中可以看出 Nginx 的服务和端口都是正常的</p>
<p><img src="https://kb.fit2cloud.com/upload/metersphere/%E5%9B%BE%E7%89%87-wpmm.png" alt="img"></p>
<p>键入 <code>exit</code> 回到宿主机，执行 <code>netstat -lnt</code> 查看宿主机的端口；</p>
<p>如下图所示，在宿主机并没有 Nginx 的端口，这是因为容器中的端口并没有映射到宿主机上，所以在宿主机无法访问到 Nginx 的服务。</p>
<p><img src="https://kb.fit2cloud.com/upload/metersphere/%E5%9B%BE%E7%89%87-nypd.png" alt="img"></p>
<h2 id="3-1-如何访问容器服务"><a href="#3-1-如何访问容器服务" class="headerlink" title="3.1 如何访问容器服务"></a>3.1 如何访问容器服务</h2><p>我们在运行容器时使用 -p 参数将容器端口映射到宿主机端口</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name nginx_test -p 8080:80 nginx</span><br><span class="line"></span><br><span class="line">注释：</span><br><span class="line">-p 8080:80	</span><br></pre></td></tr></table></figure>
<p>容器运行后，在宿主机执行 <code>netstat -lnt</code> 可以看到，宿主机已经监听了 8080 端口;</p>
<p><img src="https://kb.fit2cloud.com/upload/metersphere/%E5%9B%BE%E7%89%87-xvlt.png" alt="img"></p>
<p>查询服务器的 IP，使用 curl 命令访问 IP 地址 + 端口，可以返回 Nginx 服务的信息，说明可以正常访问 Nginx 服务了；</p>
<p><img src="https://kb.fit2cloud.com/upload/metersphere/%E5%9B%BE%E7%89%87-nsbo.png" alt="img"></p>
<p>当然，用浏览器一样可以得到 Nginx 页面信息。</p>
<h2 id="3-2-如何将容器内数据持久化存储"><a href="#3-2-如何将容器内数据持久化存储" class="headerlink" title="3.2 如何将容器内数据持久化存储"></a><img src="https://kb.fit2cloud.com/upload/metersphere/%E5%9B%BE%E7%89%87-epst.png" alt="img">3.2 如何将容器内数据持久化存储</h2><p>我们先来做个测试，测试内容是修改容器内的文件，然后删除容器、重建容器，查看文件是否会保持修改后的状态。</p>
<p><strong>第一步、修改 Nginx 容器的 index.html 查看是否生效</strong></p>
<p>我们尝试通过修改 Nginx 的 index.html 文件来更换页面信息；</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker exec -it nginx_test bash</span><br><span class="line">cd nginx/html</span><br><span class="line">vi index.html</span><br><span class="line">This is the demo page.</span><br></pre></td></tr></table></figure>
<p><img src="https://kb.fit2cloud.com/upload/metersphere/%E5%9B%BE%E7%89%87-xdfx.png" alt="img"></p>
<p>退出容器，使用 curl 命令访问 Nginx 服务</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl 10.1.13.130:8080</span><br></pre></td></tr></table></figure>
<p>可以返回我们更换的文本内容，index.html 修改完成。</p>
<p><img src="https://kb.fit2cloud.com/upload/metersphere/%E5%9B%BE%E7%89%87-jonf.png" alt="img"></p>
<p><strong>第二步、删除 Nginx 容器，然后重新创建 Nginx， 观察 index.html 内容是否保持修改后状态</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker rm -f nginx_test</span><br><span class="line">docker run -d --name nginx_test -p 8080:80 nginx</span><br></pre></td></tr></table></figure>
<p><img src="https://kb.fit2cloud.com/upload/metersphere/%E5%9B%BE%E7%89%87-rsun.png" alt="img"></p>
<p>完成重建后，使用 curl 命令访问 nginx 服务</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl 10.1.13.130:8080</span><br></pre></td></tr></table></figure>
<p><img src="https://kb.fit2cloud.com/upload/metersphere/%E5%9B%BE%E7%89%87-nrso.png" alt="img"></p>
<p>可见，curl 返回了 Nginx 默认的页面信息，并不是我们修改的内容，<strong>这是因为我们删除了容器，容器内的所有文件都一同删除了。</strong>如果想在删除容器时，保持指定文件或目录不被删除，该怎么做呢</p>
<p><strong>将宿主机的目录映射到容器目录，我们称这个操作为：持久化存储</strong></p>
<p>在创建容器时使用 -v 参数将宿主机目录映射到容器目录</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name nginx_test -p 8080:80 -v /data/nginx:/opt/nginx/html nginx</span><br><span class="line"></span><br><span class="line">注释：</span><br><span class="line">-v /data/nginx:/opt/nginx/html </span><br></pre></td></tr></table></figure>
<p>然后我们用同样的方法，在 Nginx 容器中新建一个 index.html，内容自定义，然后删除容器、重建容器；</p>
<p>操作步骤如下图：</p>
<p><img src="https://kb.fit2cloud.com/upload/metersphere/%E5%9B%BE%E7%89%87-zviu.png" alt="img"></p>
<p>可以发现，index.html 文件会保持自定义的内容；</p>
<p>这是因为 index.html 创建到了宿主机的目录 /data/nginx 中，宿主机的目录 /data/nginx 映射到了容器中的 /opt/nginx/html 目录，即使删除容器，宿主机的文件也不会删除，再次创建容器仍然映射原目录，使得文件持久化存储。</p>
<p>我们在创建运行容器时使用命令： <code>docker run -d nginx_test nginx</code></p>
<p>命令最后的 “nginx” 是 Docker 官方仓库提供的 Nginx 镜像，我们也可以自己构建一个镜像来使用。</p>
<p>构建镜像需要使用 dockerfile 文件，我们以 Nginx 为例，编写一个 Nginx 镜像的 dockerfile：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">vi dockerfile</span><br><span class="line">FROM centos:7.9.2009</span><br><span class="line"></span><br><span class="line">WORKDIR /opt</span><br><span class="line"></span><br><span class="line">ADD nginx-1.24.0.tar.gz /opt</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">RUN yum install -y nc net-tools gcc-c++ pcre pcre-devel zlib zlib-devel openssl openssl-devel &amp;&amp; \</span><br><span class="line">yum clean all &amp;&amp; \</span><br><span class="line">rm -rf /tmp/* rm -rf /var/cache/yum/* &amp;&amp; \</span><br><span class="line">cd /opt/nginx-1.24.0 &amp;&amp; \</span><br><span class="line">./configure --user=nobody --group=nobody --prefix=/opt/nginx --with-http_gzip_static_module --with-http_ssl_module --with-stream &amp;&amp; \</span><br><span class="line">make &amp;&amp; make install &amp;&amp; \</span><br><span class="line">rm -rf /opt/nginx-1.24.0</span><br><span class="line"></span><br><span class="line">CMD /opt/nginx/sbin/nginx &amp;&amp; tail -f /dev/null</span><br></pre></td></tr></table></figure>
<p>注释：</p>
<p>FROM #构建镜像需要一个基础镜像，centos:7.9.2009 就是一个基础镜像</p>
<p>WORKDIR #指定工作目录</p>
<p>ADD #将宿主机目录的文件拷贝到容器中并自动解压，宿主机的文件与 dockerfile 位于相同目录中</p>
<p>RUN #在基础镜像上要执行的命令</p>
<p>CMD #指定启动容器时执行的命令</p>
<p><strong>构建镜像</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker build -t nginx:v2 .</span><br><span class="line"></span><br><span class="line">注释：</span><br><span class="line">-t	</span><br><span class="line">. 	</span><br></pre></td></tr></table></figure>
<p><img src="https://kb.fit2cloud.com/upload/metersphere/%E5%9B%BE%E7%89%87-wcmn.png" alt="img"></p>
<p>构建后的镜像名为 nginx:v2 , 在创建容器时可以这样使用:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -f nginx_test nginx:v2</span><br></pre></td></tr></table></figure>
<p>说明：本教程中所有使用的 Nginx 镜像都是基于这个自定义构建的镜像操作的，因为官方的 Nginx 镜像中没有 ifconfig、netstat、nc 等命令，如果你在按照文章操作，请使用这个构建的镜像来操作。</p>
<p><strong>启动容器</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name nginx_test -p 8080:80 -v /data/nginx:/opt/nginx/html nginx</span><br></pre></td></tr></table></figure>
<p>参数：</p>
<p>-d #后台运行</p>
<p>-p #端口映射，-p 8080:80， 8080 表示宿主机端口，80 表示容器端口</p>
<p>-v #目录映射，-v /data/nginx:/opt/nginx，/data/nginx 表示宿主机目录，/opt/nginx，/opt/nginx 表示容器目录</p>
<p>—name #设置容器名称</p>
<p>nginx #容器镜像</p>
<p><strong>查看正在运行的容器</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker ps</span><br></pre></td></tr></table></figure>
<p>参数：</p>
<p>-a #查看运行的所有容器，包括运行状态和停止状态的容器</p>
<p><strong>启动、停止、重启容器</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker start nginx_test </span><br><span class="line">docker stop nginx_test </span><br><span class="line">docker restart nginx_test </span><br></pre></td></tr></table></figure>
<p><strong>进入容器</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker exec -it nginx_test bash</span><br></pre></td></tr></table></figure>
<p>参数：</p>
<p>-it #打开终端交互（进入容器操作）</p>
<p><strong>删除运行的容器</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker rm -f nginx_test</span><br></pre></td></tr></table></figure>
<p><strong>查看容器镜像</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker images</span><br></pre></td></tr></table></figure>
<p><strong>删除容器镜像</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker rmi nginx:latest</span><br><span class="line">docker rmi d6454d54b3d9 (IMAGE ID)</span><br></pre></td></tr></table></figure>
<p><strong>下载容器镜像</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker search nginx</span><br><span class="line">docker pull nginx</span><br></pre></td></tr></table></figure>
<p><strong>镜像导出为文件</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker save nginx:latest nginx.tar</span><br></pre></td></tr></table></figure>
<p><strong>从文件导入镜像</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker load &lt; nginx.tar</span><br></pre></td></tr></table></figure>
<p><strong>编译镜像</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build -t nginx:v1 .</span><br></pre></td></tr></table></figure>
<h2 id="6-1-docker-copose-介绍"><a href="#6-1-docker-copose-介绍" class="headerlink" title="6.1 docker-copose 介绍"></a>6.1 docker-copose 介绍</h2><ul>
<li>docker-compose 是一个容器编排工具（自动化部署、管理）;</li>
<li>它用来在单台 Linux 服务器上运行多个 Docker 容器;</li>
<li>docker-compose 使用 YAML 文件来配置所有需要运行的 Docker 容器，该 YAML 文件的默认名称为 docker-compose.yml</li>
</ul>
<h2 id="6-2-docker-compose-安装"><a href="#6-2-docker-compose-安装" class="headerlink" title="6.2 docker-compose 安装"></a>6.2 docker-compose 安装</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">curl -L &quot;https://github.com/docker/compose/releases/download/v2.18.1/docker-compose-$(uname -s)-$(uname -m)&quot; -o /usr/local/bin/docker-compose</span><br><span class="line">chmod +x /usr/local/bin/docker-compose</span><br><span class="line">ln -s /usr/local/bin/docker-compose /usr/bin/docker-compose</span><br><span class="line">docker-compose version</span><br></pre></td></tr></table></figure>
<h2 id="6-3-使用-docker-compose-启动一个容器"><a href="#6-3-使用-docker-compose-启动一个容器" class="headerlink" title="6.3 使用 docker-compose 启动一个容器"></a>6.3 使用 docker-compose 启动一个容器</h2><p>以下是 docker-compose.yml 的内容</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">version: &#x27;2.1&#x27;</span><br><span class="line">services:</span><br><span class="line">  nginx:</span><br><span class="line">    image: nginx:latest</span><br><span class="line">    container_name: nginx_test</span><br><span class="line">    ports:</span><br><span class="line">      - 8080:80</span><br><span class="line">    volumes:</span><br><span class="line">      - /opt/nginx:/opt/nginx/html</span><br></pre></td></tr></table></figure>
<p>参数：</p>
<p>compose 文件格式的版本，恒定为 2.1</p>
<p>services 标签下可以定义多个类似 nginx 这样的服务</p>
<p>container_name 服务定义， nginx_test 是容器的名称</p>
<p>image nginx 容器所使用的镜像</p>
<p>ports 定义端口映射，本例将容器内的 80 端口映射到宿主机的 8080 端口</p>
<p>volumes 定义目录映射，本例将容器内的 /opt/nginx/html 目录映射到宿主机的 /opt/nginx 目录</p>
<p><strong>启动容器</strong></p>
<p>在 docker-compose 所在目录执行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker compose up -d</span><br></pre></td></tr></table></figure>
<p><em>参数：</em></p>
<p><em>up 表示启动</em></p>
<p><em>-d 表示后台运行</em></p>
<p><em>-f 指定 docker-compose 文件位置 docker-compose -f /root/docker-compose/docker-compose.yml up -d</em></p>
<h2 id="6-4-Dockerdocker-compose-命令总结"><a href="#6-4-Dockerdocker-compose-命令总结" class="headerlink" title="6.4 Dockerdocker-compose 命令总结"></a>6.4 Dockerdocker-compose 命令总结</h2><p>在 docker-compose 所在目录执行</p>
<p><strong>启动容器</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose up -d</span><br></pre></td></tr></table></figure>
<p><strong>停止容器</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose down</span><br></pre></td></tr></table></figure>
<p><strong>重启容器</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose restart</span><br></pre></td></tr></table></figure>
<p><strong>重载 docker-compose.yml</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose up --force-recreate -d</span><br></pre></td></tr></table></figure>
<h2 id="6-5-docker-compose-创建多个容器"><a href="#6-5-docker-compose-创建多个容器" class="headerlink" title="6.5 docker-compose 创建多个容器"></a>6.5 docker-compose 创建多个容器</h2><p>使用 docker-compose 启动 Nginx 和 Redis 两个容器：</p>
<p>docker-compose.yml 内容如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">version: &#x27;2.1&#x27;</span><br><span class="line">services:</span><br><span class="line"></span><br><span class="line">  nginx:</span><br><span class="line">    image: nginx:latest</span><br><span class="line">    container_name: nginx_host1</span><br><span class="line">    ports:</span><br><span class="line">      - 8081:80</span><br><span class="line">    volumes:</span><br><span class="line">      - /opt/nginx:/opt/nginx/html</span><br><span class="line">    networks:</span><br><span class="line">      - host1-network</span><br><span class="line"></span><br><span class="line">  redis:</span><br><span class="line">    image: redis:latest</span><br><span class="line">    container_name: redis_host1</span><br><span class="line">    ports:</span><br><span class="line">      - 63790:6379</span><br><span class="line">    networks:</span><br><span class="line">      - host1-network</span><br><span class="line"></span><br><span class="line">networks:</span><br><span class="line">  host1-network:</span><br><span class="line">    driver: bridge</span><br><span class="line">    ipam:</span><br><span class="line">      driver: default</span><br><span class="line">      config:</span><br><span class="line">        - subnet: 192.168.11.0/24</span><br><span class="line">          gateway: 192.168.11.254</span><br></pre></td></tr></table></figure>
<p>参数：</p>
<p>networks 定义容器网络，host1-network 为定义的网络名称，</p>
<p>config 网络配置，subnet 代表网段，gateway 代表网关。</p>
<p>执行创建命令</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose up -d</span><br></pre></td></tr></table></figure>
<p>可以看到成功创建了 Nginx 和 Redis 两个容器</p>
<p><img src="https://kb.fit2cloud.com/upload/metersphere/%E5%9B%BE%E7%89%87-kepz.png" alt="img"></p>
<p>可以进入 nginx_host1 容器查看一下端口和 IP</p>
<p><img src="https://kb.fit2cloud.com/upload/metersphere/%E5%9B%BE%E7%89%87-arbk.png" alt="img"></p>
<p>上图可见，nginx_host1 的 IP 为：192.168.11.2 , 符合 docker-compose 中定义的 192.168.11.0/24 网段；</p>
<p>如果访问 Redis 可以直接使用 docker-compose 定义的 redis_host1 容器名访问即可。</p>
<p><em>以上是 Docker 的入门教程，欢迎大家留言评论交流！</em></p>
</div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div><div id="comment-switch"><span class="first-comment">Valine</span><span class="switch-btn"></span><span class="second-comment">Giscus</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div><div><div id="giscus-wrap"></div></div></div></div></div></main><footer id="footer"><br></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button id="chat_btn" type="button" title="聊天"><i class="fas fa-sms"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: '6YJscbvqXJK7VrKYNhElZKr7-MdYXbMMI',
      appKey: 'zLLLAr1WaeicJQyhF896Mmcu',
      avatar: 'monsterid',
      serverURLs: '',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: false
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !false) {
  if (false) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script><script>function getGiscusTheme () {
  return document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'light'
}

function loadGiscus () {
  const config = Object.assign({
    src: 'https://giscus.app/client.js',
    'data-repo': 'nwskj/giscus',
    'data-repo-id': 'R_kgDOKiAXwA',
    'data-category-id': 'DIC_kwDOKiAXwM4CaPaz',
    'data-mapping': 'pathname',
    'data-theme': getGiscusTheme(),
    'data-reactions-enabled': '1',
    crossorigin: 'anonymous',
    async: true
  },null)

  let ele = document.createElement('script')
  for (let key in config) {
    ele.setAttribute(key, config[key])
  }
  document.getElementById('giscus-wrap').insertAdjacentElement('afterbegin',ele)
}

function changeGiscusTheme () {
  function sendMessage(message) {
    const iframe = document.querySelector('iframe.giscus-frame')
    if (!iframe) return
    iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app')
  }

  sendMessage({
    setConfig: {
      theme: getGiscusTheme()
    }
  });
}

if ('Valine' === 'Giscus' || !false) {
  if (false) btf.loadComment(document.getElementById('giscus-wrap'), loadGiscus)
  else loadGiscus()
} else {
  function loadOtherComment () {
    loadGiscus()
  }
}</script></div><script src="//code.tidio.co/3sgwgnvwwlioumvhyqnzuska9saypugg.js" async="async"></script><script>function onTidioChatApiReady() {
  window.tidioChatApi.hide();
  window.tidioChatApi.on("close", function() {
    window.tidioChatApi.hide();
  });
}
if (window.tidioChatApi) {
  window.tidioChatApi.on("ready", onTidioChatApiReady);
} else {
  document.addEventListener("tidioChat-ready", onTidioChatApiReady);
}

var chatBtnFn = () => {
  document.getElementById("chat_btn").addEventListener("click", function(){
    window.tidioChatApi.show();
    window.tidioChatApi.open();
  });
}
chatBtnFn()
</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>